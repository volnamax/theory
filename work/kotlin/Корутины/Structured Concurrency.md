#todo 
Structured Concurrency (–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å) –≤ Kotlin Coroutines
–º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –∫–æ—Ä—É—Ç–∏–Ω

üìå –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:
Structured Concurrency (–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å) ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –∏–º–µ—é—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏–∑ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏.

üëâ –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ—Ä—É—Ç–∏–Ω—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ—Å–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ CoroutineScope.
üîπ –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å?

‚ùå –ü—Ä–æ–±–ª–µ–º–∞ "–¥–∏–∫–æ–≥–æ" –∑–∞–ø—É—Å–∫–∞ –∫–æ—Ä—É—Ç–∏–Ω
–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ—Ä—É—Ç–∏–Ω—ã –±–µ–∑ CoroutineScope, –∏—Ö —Å–ª–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –∏ –æ–Ω–∏ –º–æ–≥—É—Ç —É—Ç–µ–∫–∞—Ç—å.

‚úÖ Structured Concurrency —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É

    –ö–∞–∂–¥–∞—è –∫–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º Scope.
    –ï—Å–ª–∏ scope –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è, –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–æ—Ä—É—Ç–∏–Ω—ã —Ç–æ–∂–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è.
    –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º.

üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Structured Concurrency –≤ Kotlin?
1Ô∏è‚É£ CoroutineScope –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–í—Å–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ CoroutineScope.

import kotlinx.coroutines.*

fun main() = runBlocking {
    launch {
        delay(1000)
        println("–ö–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å")
    }
    println("–ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ—Ä—É—Ç–∏–Ω—ã...")
}

‚úÖ –ï—Å–ª–∏ runBlocking –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è ‚Äî –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—Ç—Å—è!
2Ô∏è‚É£ coroutineScope –∏ supervisorScope

–û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≥—Ä—É–ø–ø—ã –∫–æ—Ä—É—Ç–∏–Ω.
‚úÖ coroutineScope {} ‚Äì –æ—Ç–º–µ–Ω—è–µ—Ç –≤—Å–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ

suspend fun fetchData() = coroutineScope {
    launch {
        delay(1000)
        println("–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
    }
    launch {
        delay(500)
        throw RuntimeException("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏") // –û—Ç–º–µ–Ω–∏—Ç –í–°–ï –∫–æ—Ä—É—Ç–∏–Ω—ã
    }
}

üîπ –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç?

    –ü–µ—Ä–≤–∞—è –∫–æ—Ä—É—Ç–∏–Ω–∞ –Ω–∞—á–Ω—ë—Ç –∑–∞–≥—Ä—É–∑–∫—É.
    –í—Ç–æ—Ä–∞—è –∫–æ—Ä—É—Ç–∏–Ω–∞ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É –∏ –æ—Ç–º–µ–Ω–∏—Ç –≤—Å—ë –≤–Ω—É—Ç—Ä–∏ coroutineScope.

‚úÖ supervisorScope {} ‚Äì –ù–ï –æ—Ç–º–µ–Ω—è–µ—Ç –¥—Ä—É–≥–∏–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ

suspend fun fetchData() = supervisorScope {
    launch {
        delay(1000)
        println("–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
    }
    launch {
        delay(500)
        throw RuntimeException("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏") // –ù–µ –æ—Ç–º–µ–Ω–∏—Ç –ø–µ—Ä–≤—É—é –∫–æ—Ä—É—Ç–∏–Ω—É
    }
}

üîπ –†–∞–∑–Ω–∏—Ü–∞?
–í supervisorScope, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–¥–Ω–∞ –∫–æ—Ä—É—Ç–∏–Ω–∞ —É–ø–∞–ª–∞, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
3Ô∏è‚É£ Job —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ—Ä—É—Ç–∏–Ω

–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è launch, –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Job, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å.

val job = CoroutineScope(Dispatchers.IO).launch {
    delay(2000)
    println("–ö–æ—Ä—É—Ç–∏–Ωa –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å")
}

job.cancel()  // –û—Ç–º–µ–Ω–∏—Ç –∫–æ—Ä—É—Ç–∏–Ω—É –¥–æ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

‚úÖ Structured Concurrency –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–æ—Ä—É—Ç–∏–Ω–∞ –Ω–µ "–∑–∞–≤–∏—Å–Ω–µ—Ç" –Ω–∞–≤—Å–µ–≥–¥–∞.
4Ô∏è‚É£ viewModelScope –∏ lifecycleScope –≤ Android

–í Android Structured Concurrency –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ ViewModel –∏ Lifecycle:
‚úÖ viewModelScope (–ø—Ä–∏–≤—è–∑–∞–Ω –∫ ViewModel)

class MyViewModel : ViewModel() {
    fun fetchData() {
        viewModelScope.launch {
            val data = getDataFromNetwork()
            println(data)
        }
    }
}

‚è≥ –ö–æ—Ä—É—Ç–∏–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è, –∫–æ–≥–¥–∞ ViewModel —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è.
‚úÖ lifecycleScope (–ø—Ä–∏–≤—è–∑–∞–Ω –∫ Activity / Fragment)

class MyActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        lifecycleScope.launch {
            delay(1000)
            println("–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã")
        }
    }
}

‚ö° –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ onDestroy() –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
üîπ –ò—Ç–æ–≥

‚úÖ Structured Concurrency ‚Äî —ç—Ç–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ—Ä—É—Ç–∏–Ω
‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (CoroutineScope)
‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –∏ "–≤–µ—á–Ω—ã–µ" –∫–æ—Ä—É—Ç–∏–Ω—ã
‚úÖ –í Android –ø–æ–º–æ–≥–∞–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ—Ä—É—Ç–∏–Ω–∞–º–∏ —Å viewModelScope –∏ lifecycleScope

üí° –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –ö–æ—Ä—É—Ç–∏–Ω—ã –¥–æ–ª–∂–Ω—ã —É–º–∏—Ä–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å –∏—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–º, –∞ –Ω–µ –≤–∏—Å–µ—Ç—å –≤ –ø–∞–º—è—Ç–∏! üöÄ


[[kotlin]]