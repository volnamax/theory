### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Bitmap) –≤ Android –∏ –ü—É–ª Bitmap'–æ–≤**

–í Android **Bitmap** ‚Äì —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏. –û–Ω –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å **–æ—á–µ–Ω—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏**, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –≤—ã—Å–æ–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏. –ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**.
## **1Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ Bitmap**

–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –º–æ–∂–Ω–æ **–ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å –ø–∞–º—è—Ç—å (OutOfMemoryError)**. –ü–æ—ç—Ç–æ–º—É Android –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–∞–±–æ—Ç—ã —Å Bitmap**:

‚úî **–°–∂–∞—Ç–∏–µ –∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞**  
‚úî **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `BitmapFactory.Options`**  
‚úî **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `BitmapPool`**  
‚úî **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Glide/Picasso** –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
## **2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `BitmapFactory.Options` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞**

üìå **–ü—Ä–æ–±–ª–µ–º–∞**: –∑–∞–≥—Ä—É–∂–∞–µ–º 4K-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∞ —ç–∫—Ä–∞–Ω –≤—Å–µ–≥–æ 1080p ‚Üí —Ç—Ä–∞—Ç–∏—Ç—Å—è –ª–∏—à–Ω—è—è –ø–∞–º—è—Ç—å.  
üìå **–†–µ—à–µ–Ω–∏–µ**: —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä —Å –ø–æ–º–æ—â—å—é `inSampleSize`.

### **–ü—Ä–∏–º–µ—Ä: —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π**
```kotlin
fun decodeSampledBitmapFromResource(
    res: Resources, resId: Int, reqWidth: Int, reqHeight: Int
): Bitmap {
    val options = BitmapFactory.Options().apply {
        inJustDecodeBounds = true // –¢–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã, –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏
    }
    BitmapFactory.decodeResource(res, resId, options)

    // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è
    options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight)

    // –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ–º —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    options.inJustDecodeBounds = false
    return BitmapFactory.decodeResource(res, resId, options)
}

fun calculateInSampleSize(options: BitmapFactory.Options, reqWidth: Int, reqHeight: Int): Int {
    val (height: Int, width: Int) = options.outHeight to options.outWidth
    var inSampleSize = 1

    if (height > reqHeight || width > reqWidth) {
        val halfHeight = height / 2
        val halfWidth = width / 2

        while (halfHeight / inSampleSize >= reqHeight && halfWidth / inSampleSize >= reqWidth) {
            inSampleSize *= 2
        }
    }
    return inSampleSize
}

```
## **3Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ `BitmapPool` –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?**

üìå **–ü—Ä–æ–±–ª–µ–º–∞**: –ø—Ä–∏ —á–∞—Å—Ç–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–µ—Ç—Å—è **–º–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤ Bitmap**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **GC (Garbage Collection)** –∏ –ª–∞–≥–∞–º.  
üìå **–†–µ—à–µ–Ω–∏–µ**: `BitmapPool` ‚Äì —ç—Ç–æ **–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** –æ–±—ä–µ–∫—Ç–æ–≤ `Bitmap`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**

- –í–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è `Bitmap`, –æ–Ω **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø—É–ª–µ** –∏ **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ**.
- **Glide** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `BitmapPool` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è BitmapPool –≤—Ä—É—á–Ω—É—é**

```kotlin
val bitmapPool = LruBitmapPool(10 * 1024 * 1024) // 10MB Pool

// –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º Bitmap
val bitmap = bitmapPool.get(200, 200, Bitmap.Config.ARGB_8888)
bitmap.eraseColor(Color.RED) // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ

// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ Pool –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
bitmapPool.put(bitmap)

```

## **4Ô∏è‚É£ Glide –∏ Picasso ‚Äì –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**

–í–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å `Bitmap`, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

### **Glide (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π BitmapPool)**

‚úÖ Glide **—É–º–Ω–µ–µ**, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `BitmapPool` –∏ –∫–µ—à–∏—Ä—É–µ—Ç –≤ –ø–∞–º—è—Ç–∏ + –¥–∏—Å–∫–µ.  
‚úÖ Picasso –ø—Ä–æ—â–µ, –Ω–æ **–º–µ–Ω—å—à–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏—è**.

## **5Ô∏è‚É£ –ò—Ç–æ–≥–∏**

üîπ **–ù–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**  
üîπ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `BitmapFactory.Options.inSampleSize` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞**  
üîπ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `BitmapPool` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–∏—Ç–º–∞–ø–æ–≤**  
üîπ **–õ—É—á—à–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Glide, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –¥–µ–ª–∞–µ—Ç –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

**üî• –í–æ–ø—Ä–æ—Å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏:**  
üìù "–ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É Bitmap –≤ Android?"  
‚úÖ **–û—Ç–≤–µ—Ç:** "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `BitmapFactory.Options` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞, `BitmapPool` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ Glide –∏–ª–∏ Picasso –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è."
[[android]]